<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Monitor Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.5.0/chart.umd.min.js"></script>
        <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0d1117; color: #c9d1d9; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; padding: 20px; }
        h1 { color: #fbbf24; margin-bottom: 20px; font-size: 1.4rem; font-weight: 600; }
        .stats { display: flex; gap: 16px; margin-bottom: 24px; }
        .card { background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 16px; flex: 1; }
        .card h3 { color: #8b949e; font-size: 0.75rem; margin-bottom: 6px; font-weight: 500; letter-spacing: 0.5px; }
        .card .value { font-size: 1.8rem; font-weight: 600; }
        .cpu-val { color: #fbbf24; }
        .mem-val { color: #14b8a6; }
        .net-val { color: #22c55e; }
        .charts { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .chart-card { background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 16px; }
        .chart-card h3 { color: #8b949e; font-size: 0.75rem; margin-bottom: 12px; font-weight: 500; letter-spacing: 0.5px; }
        .status { font-size: 0.7rem; color: #6e7681; margin-top: 20px; }
    </style>
</head>
<body>
        <h1>Linux System Monitor</h1>

    <div class="stats">
        <div class="card">
            <h3>CPU USAGE</h3>
            <div class="value cpu-val" id="cpu-val">--%</div>
        </div>
        <div class="card">
            <h3>MEMORY USED</h3>
            <div class="value mem-val" id="mem-val">-- MB</div>
        </div>
        <div class="card">
            <h3>NETWORK RX</h3>
            <div class="value net-val" id="net-val">-- KB</div>
        </div>
    </div>

    <div class="charts">
        <div class="chart-card">
            <h3>CPU HISTORY</h3>
            <canvas id="cpuChart"></canvas>
        </div>
        <div class="chart-card">
            <h3>MEMORY HISTORY</h3>
            <canvas id="memChart"></canvas>
        </div>
    </div>

    <div class="status" id="status">Connecting...</div>

    <script>
        const API = 'http://localhost:8000';
        const MAX_POINTS = 30;

        const chartConfig = (label, color) => ({
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label,
                    data: [],
                    borderColor: color,
                    backgroundColor: color + '22',
                    borderWidth: 2,
                    pointRadius: 0,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                animation: false,
                scales: {
                    x: { display: false },
                    y: { 
                        ticks: { color: '#8b949e', font: { size: 10 } },
                        grid: { color: '#21262d' }
                    }
                },
                plugins: { legend: { display: false } }
            }
        });

        const cpuChart = new Chart(document.getElementById('cpuChart'), chartConfig('CPU %', '#fbbf24'));
        const memChart = new Chart(document.getElementById('memChart'), chartConfig('MEM MB', '#14b8a6'));

        function addPoint(chart, label, value) {
            chart.data.labels.push(label);
            chart.data.datasets[0].data.push(value);
            if (chart.data.labels.length > MAX_POINTS) {
                chart.data.labels.shift();
                chart.data.datasets[0].data.shift();
            }
            chart.update();
        }

        async function fetchLatest() {
            try {
                const res = await fetch(`${API}/metrics/latest`);
                const d = await res.json();
                const time = new Date(d.timestamp * 1000).toLocaleTimeString();

                document.getElementById('cpu-val').textContent = d.cpu_pct.toFixed(2) + '%';
                document.getElementById('mem-val').textContent = d.mem_used_mb + ' MB';
                document.getElementById('net-val').textContent = d.rx_kb + ' KB';
                document.getElementById('status').textContent = `Last updated: ${time}`;

                addPoint(cpuChart, time, d.cpu_pct);
                addPoint(memChart, time, d.mem_used_mb);
            } catch (e) {
                document.getElementById('status').textContent = 'Error: API not reachable';
            }
        }

        fetchLatest();
        setInterval(fetchLatest, 3000);
    </script>
</body>
</html>